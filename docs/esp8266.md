# ESP8266 Temperature Sensor - Setup & Run Guide

This docs explains how to configure and run a MicroPython program on ESP8266 that reads temperature and humidity from a DHT22 sensor and publishes the data to an MQTT broker.

---

## 1. Configuring ESP8266

### 1.1 Download MicroPython

Download the latest MicroPython firmware for ESP8266:  
[https://micropython.org/download/ESP8266_GENERIC/](https://micropython.org/download/ESP8266_GENERIC/)

### 1.2 Prepare Project Environment

```bash
cd esp8266
python -m venv venv
venv/Scripts/activate       # Windows
# source venv/bin/activate  # Linux/macOS
```

### 1.3 Install Required Packages

```bash
pip install -r requirements.txt
```

### 1.4 Erase ESP8266 Flash Memory

```bash
python -m esptool --port COM5 erase_flash
```

### 1.5 Flash MicroPython Firmware

Example for ESP8266 connected to port COM5:

```bash
python -m esptool --port COM5 --baud 460800 write_flash --flash_size=detect 0 micropython.bin
```

## 2. Running the ESP8266 Program

### 2.1 Hardware Setup

- Connect the DHT22 sensor to a chosen GPIO pin on ESP8266 (e.g., PIN 12).

### 2.2 Environment Configuration

In `main.py`, set the WiFi and MQTT parameters:

```python
SSID = "<WIFI_SSID>"
PASSWORD = "<WIFI_PASS>"

PIN = 12

BROKER = "<broker_address>"
CLIENT_ID = "<client_id>"
SUBSCRIPTION = b"<sub_name>"
MQTT_USER = "<user>"
MQTT_PASSWORD = "<password>"
```

### 2.3 Upload Code to ESP8266

```bash
ampy --port COM5 put main.py
```

## 3. Notes

- Ensure the correct COM port is used
- After running, ESP8266 automatically connects to WiFi and publishes temperature and humidity data to the configured MQTT broker.
- Data is sent in JSON format with timestamps in ISO 8601 UTC
- Status codes are integer values representing the measurement state [ENUMS are not allowed in MicroPython]:
  - `0 = Success` - Data was measured successfully from the sensor
  - `1 = DataError` - Failed to read parameters from the DHT22 sensor
  - `2 = CriticalError` - A critical error occurred. The ESP8266 will atempt to send this information through MQTT and then will restart.
